"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[392],{43223:function(e,t,a){var i=a(65443),o=a.n(i),s=a(99581),n=a(70079),r=a(93850),l=a(3939),c=a(82248),d=a(59216),m=a(46824),u=a(81433),p=a(10159),h=a(15063),_=a(64645),b=a(17834),x=a(18883),v=a(7936),g=a(15312),j=a(75987),f=a(650),N=a(23351),y=a(63983),Z=a(48405),A=a(82963),S=a(87036),w=a(46583),k=a(96328),D=a(12106),C=a(57834),E=a(35250);function I(e){let{children:t}=e;const{automationName:a,automationStatus:i,showIconLabels:o}=(0,p.Z)((e=>({automationName:e(D.storeName).getAutomationData().name,automationStatus:e(D.storeName).getAutomationData().status,showIconLabels:e(D.storeName).isFeatureActive("showIconLabels")})),[]),s=(0,n.useRef)();let r="mailpoet-automation-editor-chip-gray";return i===C.b.ACTIVE?r="mailpoet-automation-editor-chip-success":i===C.b.DEACTIVATING&&(r="mailpoet-automation-editor-chip-danger"),(0,E.jsx)("div",{className:"edit-site-document-actions has-secondary-label",children:(0,E.jsx)("div",{ref:s,className:"edit-site-document-actions__title-wrapper",children:t&&(0,E.jsx)(A.Z,{popoverProps:{placement:"bottom",anchor:s.current},renderToggle:e=>{let{isOpen:t,onToggle:s}=e;return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsxs)(l.ZP,{className:"mailpoet-automation-editor-dropdown-toggle-link",onClick:s,children:[(0,E.jsxs)(S.Z,{size:"body",className:"edit-site-document-actions__title",as:"h1",children:[(0,E.jsx)(w.Z,{as:"span",children:(0,v.__)("Editing automation:","mailpoet")}),a]}),(0,E.jsxs)(S.Z,{size:"body",className:`edit-site-document-actions__secondary-item ${r}`,children:[i===C.b.ACTIVE&&(0,v.__)("Active","mailpoet"),i===C.b.DEACTIVATING&&(0,v.__)("Deactivating","mailpoet"),i===C.b.DRAFT&&(0,v.__)("Draft","mailpoet")]})]}),(0,E.jsx)(l.ZP,{className:"edit-site-document-actions__get-info",icon:k.Z,"aria-expanded":t,"aria-haspopup":"true",onClick:s,label:(0,v.__)("Change automation name","mailpoet"),children:o&&(0,v.__)("Rename","mailpoet")})]})},contentClassName:"edit-site-document-actions__info-dropdown",renderContent:t})})})}I.displayName="DocumentActions";var T=a(83453),P=a(77996),F=a(60369),L=a(71652),O=a(19480);const V=d.Z,R=(0,n.createContext)(void 0);function K(e){let{stepId:t}=e;const a=(0,n.useContext)(R),{steps:i,automationData:o}=(0,p.Z)((e=>({steps:e(D.storeName).getSteps(),automationData:e(D.storeName).getAutomationData()})),[]),{openSidebar:s,selectStep:r}=(0,Z.Z)(D.storeName),l=o.steps[t],c=i.find((e=>{let{key:t}=e;return t===l.key}));return(0,E.jsxs)(T.A,{className:"mailpoet-automation-step-error",role:"listitem",state:a,onClick:()=>{s(D.stepSidebarKey),r(l)},children:[(0,E.jsx)(O.O,{icon:c.icon,foreground:c.foreground,background:c.background,width:"23px",height:"23px"}),c.title(l,"other")]})}function G(){const[e,t]=(0,n.useState)(!1),a=(0,P.u)({orientation:"vertical",shift:!0}),{errors:i,automationData:o}=(0,p.Z)((e=>({errors:e(D.storeName).getErrors(),automationData:e(D.storeName).getAutomationData()})),[]),s=(0,n.useMemo)((()=>{if(!i)return[];const e=new Map,t=o.steps.root.next_steps.map((e=>{let{id:t}=e;return t}));for(;t.length>0;){const n=t.shift();var a,s;e.has(n)||(e.set(n,i.steps[n]),null===(a=o.steps[n])||void 0===a||null===(s=a.next_steps)||void 0===s||s.forEach((e=>t.push(e.id))))}return[...e.values()].filter((e=>!!e))}),[i,o]),r=s.length>0;return(0,n.useEffect)((()=>{r&&t(!0)}),[r]),0===s.length?null:(0,E.jsxs)("div",{children:[(0,E.jsx)(l.ZP,{variant:"link",onClick:()=>t((e=>void 0!==e&&!e)),onMouseDown:()=>t((e=>e?void 0:e)),style:{textDecoration:"none",borderRadius:99999},children:(0,E.jsxs)(L.A,{children:[s.length," issues"]})}),e&&(0,E.jsx)(V,{offset:10,placement:"bottom-end",onClose:()=>t((e=>void 0===e&&void 0)),children:(0,E.jsx)(R.Provider,{value:a,children:(0,E.jsxs)(F.b,{state:a,role:"list","aria-label":(0,v.__)("Automation errors","mailpoet"),className:"mailpoet-automation-errors",children:[(0,E.jsx)("div",{className:"mailpoet-automation-errors-header",children:(0,v.__)("The following steps are not fully set:","mailpoet")}),(0,E.jsx)(j.ErrorBoundary,{children:s.map((e=>(0,E.jsx)(K,{stepId:e.step_id},e.step_id)))})]})})})]})}K.displayName="StepError";var B=a(23315),M=a(74731);function U(){const{isInserterOpened:e,showIconLabels:t}=(0,p.Z)((e=>({isInserterOpened:e(D.storeName).isInserterSidebarOpened(),showIconLabels:e(D.storeName).isFeatureActive("showIconLabels")})),[]),{toggleInserterSidebar:a}=(0,Z.Z)(D.storeName);return(0,E.jsx)(B.Z,{as:l.ZP,className:"edit-site-header-toolbar__inserter-toggle",variant:"primary",isPressed:e,onMouseDown:e=>e.preventDefault(),onClick:a,icon:M.Z,label:(0,v.__)("Toggle step inserter","mailpoet"),showTooltip:!t,children:t&&(e?(0,v.__)("Close","mailpoet"):(0,v.__)("Add","mailpoet"))})}var z=a(26013),W=a(44612),q=a(50899),H=a(71458),$=a(15439),Y=a(40806);function Q(e){let{scope:t,name:a,label:i,info:o,messageActivated:s,messageDeactivated:r,shortcut:l,onToggle:c=(()=>null),disabled:d=!1}=e;const m=(0,p.Z)((e=>!!e(Y.h).get(t,a)),[a]),{toggle:u}=(0,Z.Z)(Y.h);return(0,n.createElement)(W.Z,{icon:m&&H.Z,isSelected:m,onClick:()=>{c(),u(t,a),(()=>{if(m){const e=r||(0,v.sprintf)((0,v.__)("Preference deactivated - %s"),i);(0,$.speak)(e)}else{const e=s||(0,v.sprintf)((0,v.__)("Preference activated - %s"),i);(0,$.speak)(e)}})()},role:"menuitemcheckbox",info:o,shortcut:l,disabled:d},i)}var J=a(12025);function X(){return(0,E.jsx)(b.Eo,{className:"edit-site-more-menu",popoverProps:{className:"edit-site-more-menu__content"},children:()=>(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(z.Z,{label:(0,v._x)("View","noun","mailpoet"),children:(0,E.jsx)(Q,{scope:D.storeName,name:"fullscreenMode",label:(0,v.__)("Fullscreen mode","mailpoet"),info:(0,v.__)("Work without distraction","mailpoet"),messageActivated:(0,v.__)("Fullscreen mode activated","mailpoet"),messageDeactivated:(0,v.__)("Fullscreen mode deactivated","mailpoet"),shortcut:q.displayShortcut.secondary("f")})}),(0,E.jsx)(z.Z,{children:(0,E.jsx)(W.Z,{onClick:()=>{window.location.href=J.x.urls.automationListing},children:(0,v.__)("View all automations","mailpoet")})})]})})}var ee=a(14134);function te(e){let{onClose:t}=e;const[a,i]=(0,n.useState)(!1);return(0,E.jsxs)(ee.Z,{className:"mailpoet-automatoin-deactivate-modal",title:(0,v.__)("Stop automation for all subscribers?","mailpoet"),onRequestClose:t,children:[(0,E.jsx)("p",{children:(0,v.__)("Are you sure you want to deactivate now? This would stop this automation for all subscribers immediately.","mailpoet")}),(0,E.jsx)(l.ZP,{isBusy:a,variant:"primary",onClick:()=>{i(!0),(0,u.dispatch)(D.storeName).deactivate(!0)},children:(0,v.__)("Deactivate now","mailpoet")}),(0,E.jsx)(l.ZP,{disabled:a,variant:"tertiary",onClick:t,children:(0,v.__)("Cancel","mailpoet")})]})}function ae(e){let{onClose:t}=e;const{automationName:a}=(0,p.Z)((e=>({automationName:e(D.storeName).getAutomationData().name})),[]),[i,o]=(0,n.useState)(C.b.DEACTIVATING),[s,r]=(0,n.useState)(!1),c=(0,v.sprintf)((0,v.__)('Deactivate the "%s" automation?',"mailpoet"),a);return(0,E.jsxs)(ee.Z,{className:"mailpoet-automatoin-deactivate-modal",title:c,onRequestClose:t,children:[(0,v.__)("Some subscribers entered but have not finished the flow. Let's decide what to do in this case.","mailpoet"),(0,E.jsxs)("ul",{className:"mailpoet-automation-options",children:[(0,E.jsx)("li",{children:(0,E.jsxs)("label",{className:i===C.b.DEACTIVATING?"mailpoet-automation-option active":"mailpoet-automation-option",children:[(0,E.jsx)("span",{children:(0,E.jsx)("input",{type:"radio",disabled:s,name:"deactivation-method",checked:i===C.b.DEACTIVATING,onChange:()=>o(C.b.DEACTIVATING)})}),(0,E.jsxs)("span",{children:[(0,E.jsx)("strong",{children:(0,v.__)("Let entered subscribers finish the flow","mailpoet")}),(0,v.__)("New subscribers won't enter, but recently entered could proceed.","mailpoet")]})]})}),(0,E.jsx)("li",{children:(0,E.jsxs)("label",{className:i===C.b.DRAFT?"mailpoet-automation-option active":"mailpoet-automation-option",children:[(0,E.jsx)("span",{children:(0,E.jsx)("input",{type:"radio",disabled:s,name:"deactivation-method",checked:i===C.b.DRAFT,onChange:()=>o(C.b.DRAFT)})}),(0,E.jsxs)("span",{children:[(0,E.jsx)("strong",{children:(0,v.__)("Stop automation for all subscribers","mailpoet")}),(0,v.__)("Automation will be deactivated for all the subscribers immediately.","mailpoet")]})]})})]}),(0,E.jsx)(l.ZP,{isBusy:s,variant:"primary",onClick:()=>{r(!0),(0,u.dispatch)(D.storeName).deactivate(i!==C.b.DEACTIVATING)},children:(0,v.__)("Deactivate automation","mailpoet")}),(0,E.jsx)(l.ZP,{disabled:s,variant:"tertiary",onClick:t,children:(0,v.__)("Cancel","mailpoet")})]})}function ie(e){let{label:t}=e;const{errors:a,isDeactivating:i}=(0,p.Z)((e=>({errors:e(D.storeName).getErrors(),isDeactivating:e(D.storeName).getAutomationData().status===C.b.DEACTIVATING})),[]),{openActivationPanel:o}=(0,Z.Z)(D.storeName),s=(0,E.jsx)(l.ZP,{variant:"primary",className:"editor-post-publish-button",onClick:o,disabled:i||!!a,children:t});return i?(0,E.jsx)(f.Z,{delay:0,text:(0,v.__)("Editing an active automation is temporarily unavailable. We are working on introducing this functionality.","mailpoet"),children:s}):s}function oe(){const{save:e}=(0,Z.Z)(D.storeName),{automation:t}=(0,p.Z)((e=>({automation:e(D.storeName).getAutomationData()})),[]);return 0===t.stats.totals.in_progress?(0,E.jsx)(l.ZP,{variant:"primary",className:"editor-post-publish-button",onClick:e,children:(0,v.__)("Update","mailpoet")}):(0,E.jsx)(f.Z,{delay:0,text:(0,v.__)("Editing an active automation is temporarily unavailable. We are working on introducing this functionality.","mailpoet"),children:(0,E.jsx)(l.ZP,{variant:"primary",className:"editor-post-publish-button",onClick:e,disabled:!0,children:(0,v.__)("Update","mailpoet")})})}function se(){const{save:e}=(0,Z.Z)(D.storeName);return(0,E.jsx)(l.ZP,{variant:"tertiary",onClick:e,children:(0,v.__)("Save draft","mailpoet")})}function ne(){const[e,t]=(0,n.useState)(!1),[a,i]=(0,n.useState)(!1),{hasUsersInProgress:o}=(0,p.Z)((e=>({hasUsersInProgress:e(D.storeName).getAutomationData().stats.totals.in_progress>0})),[]);return(0,E.jsxs)(E.Fragment,{children:[e&&(0,E.jsx)(ae,{onClose:()=>{t(!1)}}),(0,E.jsx)(l.ZP,{isBusy:a,variant:"tertiary",onClick:()=>{o?t(!0):(i(!0),(0,u.dispatch)(D.storeName).deactivate())},children:(0,v.__)("Deactivate","mailpoet")})]})}function re(){const[e,t]=(0,n.useState)(!1),[a,i]=(0,n.useState)(!1),{hasUsersInProgress:o}=(0,p.Z)((e=>({hasUsersInProgress:e(D.storeName).getAutomationData().stats.totals.in_progress>0})),[]);return(0,E.jsxs)(E.Fragment,{children:[e&&(0,E.jsx)(te,{onClose:()=>{t(!1)}}),(0,E.jsx)(l.ZP,{isBusy:a,variant:"tertiary",onClick:()=>{o?t(!0):(i(!0),(0,u.dispatch)(D.storeName).deactivate())},children:(0,v.__)("Deactivate now","mailpoet")})]})}function le(e){let{showInserterToggle:t}=e;const{setAutomationName:a}=(0,Z.Z)(D.storeName),{automationName:i,automationStatus:o}=(0,p.Z)((e=>({automationName:e(D.storeName).getAutomationData().name,automationStatus:e(D.storeName).getAutomationData().status})),[]);return(0,E.jsxs)("div",{className:"edit-site-header-edit-mode",children:[(0,E.jsx)("div",{className:"edit-site-header-edit-mode_start",children:(0,E.jsx)(N.Z,{className:"edit-site-header-edit-mode__toolbar",orientation:"horizontal",role:"toolbar",children:t&&(0,E.jsx)(U,{})})}),(0,E.jsx)("div",{className:"edit-site-header-edit-mode_center",children:(0,E.jsx)(j.ErrorBoundary,{children:(0,E.jsx)(I,{children:()=>(0,E.jsxs)("div",{className:"mailpoet-automation-editor-dropdown-name-edit",children:[(0,E.jsx)("div",{className:"mailpoet-automation-editor-dropdown-name-edit-title",children:(0,v.__)("Automation name","mailpoet")}),(0,E.jsx)(y.Z,{value:i,onChange:e=>a(e),help:(0,v.__)('Give the automation a name that indicates its purpose. E.g. "Abandoned cart recovery"',"mailpoet")})]})})})}),(0,E.jsx)("div",{className:"edit-site-header-edit-mode_end",children:(0,E.jsxs)("div",{className:"edit-site-header-edit-mode__actions",children:[(0,E.jsx)(j.ErrorBoundary,{children:(0,E.jsx)(G,{})}),o===C.b.DRAFT&&(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(se,{}),(0,E.jsx)(ie,{label:(0,v.__)("Activate","mailpoet")})]}),o===C.b.ACTIVE&&(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(ne,{}),(0,E.jsx)(oe,{})]}),o===C.b.DEACTIVATING&&(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(re,{}),(0,E.jsx)(ie,{label:(0,v.__)("Update & Activate","mailpoet")})]}),(0,E.jsx)(b.Ox.Slot,{scope:D.storeName}),(0,E.jsx)(X,{})]})})]})}function ce(){const{isSidebarOpened:e,selectedStep:t}=(0,p.Z)((e=>({isSidebarOpened:e(D.storeName).isSidebarOpened,selectedStep:e(D.storeName).getSelectedStep}))),{openSidebar:a,closeSidebar:i,toggleFeature:o}=(0,Z.Z)(D.storeName),{registerShortcut:s}=(0,Z.Z)(x.h);return(0,n.useEffect)((()=>{s({name:"mailpoet/automation-editor/toggle-fullscreen",category:"global",description:(0,v.__)("Toggle fullscreen mode.","mailpoet"),keyCombination:{modifier:"secondary",character:"f"}}),s({name:"mailpoet/automation-editor/toggle-sidebar",category:"global",description:(0,v.__)("Show or hide the settings sidebar.","mailpoet"),keyCombination:{modifier:"primaryShift",character:","}})}),[s]),(0,x.bx)("mailpoet/automation-editor/toggle-fullscreen",(()=>{o("fullscreenMode")})),(0,x.bx)("mailpoet/automation-editor/toggle-sidebar",(o=>{if(o.preventDefault(),e())i();else{const e=t()?D.stepSidebarKey:D.automationSidebarKey;a(e)}})),null}a(28657);var de=a(23725),me=a(48041),ue=a(2734),pe=a(98377);const he=(0,n.forwardRef)((function(e,t){let{className:a,children:i,spokenMessage:s=i,politeness:r="polite",actions:c=[],onRemove:d,icon:m=null,explicitDismiss:u=!1,onDismiss:p,listRef:h}=e;function _(e){var t;e&&e.preventDefault&&e.preventDefault(),null==h||null===(t=h.current)||void 0===t||t.focus(),null==p||p(),null==d||d()}!function(e,t){const a="string"==typeof e?e:(0,pe.ZP)(e);(0,n.useEffect)((()=>{a&&(0,$.speak)(a,t)}),[a,t])}(s,r),(0,n.useEffect)((()=>{const e=setTimeout((()=>{u||(null==p||p(),null==d||d())}),1e4);return()=>clearTimeout(e)}),[p,d,u]);const b=o()(a,"components-snackbar",{"components-snackbar-explicit-dismiss":!!u});c&&c.length>1&&("undefined"!=typeof process&&process.env,c=[c[0]]);const x=o()("components-snackbar__content",{"components-snackbar__content-with-icon":!!m});return(0,n.createElement)("div",{ref:t,className:b,onClick:u?void 0:_,tabIndex:0,role:u?"":"button",onKeyPress:u?void 0:_,"aria-label":u?"":(0,v.__)("Dismiss this notice")},(0,n.createElement)("div",{className:x},m&&(0,n.createElement)("div",{className:"components-snackbar__icon"},m),i,c.map(((e,t)=>{let{label:a,onClick:i,url:o}=e;return(0,n.createElement)(l.ZP,{key:t,href:o,variant:"tertiary",onClick:e=>function(e,t){e.stopPropagation(),null==d||d(),t&&t(e)}(e,i),className:"components-snackbar__action"},a)})),u&&(0,n.createElement)("span",{role:"button","aria-label":"Dismiss this notice",tabIndex:0,className:"components-snackbar__dismiss-button",onClick:_,onKeyPress:_},"✕")))}));var _e=he,be=a(95073),xe=a(52750);const ve={init:{height:0,opacity:0},open:{height:"auto",opacity:1,transition:{height:{stiffness:1e3,velocity:-100}}},exit:{opacity:0,transition:{duration:.5}}};var ge=function(e){let{notices:t,className:a,children:i,onRemove:s}=e;const r=(0,n.useRef)(null),l=(0,ue.Z)();a=o()("components-snackbar-list",a);const c=e=>()=>null==s?void 0:s(e.id);return(0,n.createElement)("div",{className:a,tabIndex:-1,ref:r},i,(0,n.createElement)(be.M,null,t.map((e=>{const{content:t,...a}=e;return(0,n.createElement)(xe.E.div,{layout:!l,initial:"init",animate:"open",exit:"exit",key:e.id,variants:l?void 0:ve},(0,n.createElement)("div",{className:"components-snackbar-list__notice-container"},(0,n.createElement)(_e,(0,me.Z)({},a,{onRemove:c(e),listRef:r}),e.content)))}))))};function je(){const{notices:e}=(0,p.Z)((e=>({notices:e(m.h).getNotices()})),[]),{removeNotice:t}=(0,Z.Z)(m.h),a=e.filter((e=>{let{isDismissible:t,type:a}=e;return t&&"default"===a})),i=e.filter((e=>{let{isDismissible:t,type:a}=e;return!t&&"default"===a})),o=e.filter((e=>{let{type:t}=e;return"snackbar"===t}));return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(de.Z,{notices:i,className:"mailpoet-automation-editor-notices__notice-list"}),(0,E.jsx)(de.Z,{notices:a,className:"mailpoet-automation-editor-notices__notice-list",onRemove:t}),(0,E.jsx)(ge,{notices:o,className:"mailpoet-automation-editor-notices__snackbar-list",onRemove:t})]})}var fe=a(37392),Ne=a(45029);function ye(e){let{sidebarKey:t}=e;const{openSidebar:a}=(0,Z.Z)(D.storeName),[i,o]=t===D.automationSidebarKey?[(0,v.__)("Automation (selected)","mailpoet"),"is-active"]:[(0,v.__)("Automation","mailpoet"),""],[s,n]=t===D.stepSidebarKey?[(0,v.__)("Step (selected)","mailpoet"),"is-active"]:[(0,v.__)("Step","mailpoet"),""];return(0,E.jsxs)("ul",{children:[(0,E.jsx)("li",{children:(0,E.jsx)(l.ZP,{onClick:()=>a(D.automationSidebarKey),className:`edit-site-sidebar-edit-mode__panel-tab ${o}`,"aria-label":i,"data-label":(0,v.__)("Automation","mailpoet"),children:(0,v.__)("Automation","mailpoet")})}),(0,E.jsx)("li",{children:(0,E.jsx)(l.ZP,{onClick:()=>a(D.stepSidebarKey),className:`edit-site-sidebar-edit-mode__panel-tab ${n}`,"aria-label":s,"data-label":(0,v.__)("Step","mailpoet"),children:(0,v.__)("Step","mailpoet")})})]})}var Ze=a(63964),Ae=a(43876),Se=a(97967),we=a(9537);function ke(e){let{title:t,description:a,icon:i}=e;return(0,E.jsxs)("div",{className:"block-editor-block-card",children:[(0,E.jsx)(we.Z,{icon:i}),(0,E.jsxs)("div",{className:"block-editor-block-card__content",children:[(0,E.jsx)("h2",{className:"block-editor-block-card__title",children:t}),(0,E.jsx)("span",{className:"block-editor-block-card__description",children:a})]})]})}function De(){var e;const{errors:t}=(0,p.Z)((e=>({errors:e(D.storeName).getStepError(e(D.storeName).getSelectedStep().id)})),[]);if(!t||null==t||!t.fields)return null;const a=null===(e=t.fields)||void 0===e?void 0:e.general;return a?(0,E.jsx)(Ze.Z,{isDismissible:!1,status:"error",children:a}):null}function Ce(){const{selectedStep:e,selectedStepType:t}=(0,p.Z)((e=>({selectedStep:e(D.storeName).getSelectedStep(),selectedStepType:e(D.storeName).getSelectedStepType()})),[]);if(!e)return(0,E.jsx)(Ae.Z,{children:"No step selected."});if(!t)return(0,E.jsx)(Ae.Z,{children:"Unknown step type."});const a=t.edit;return(0,E.jsxs)("div",{className:"block-editor-block-inspector",children:[(0,E.jsx)(De,{}),(0,E.jsx)(ke,{title:t.title(e,"sidebar"),description:t.description(e,"sidebar"),icon:t.icon}),(0,E.jsx)(a,{},e.id),"trigger"===e.type&&(0,E.jsx)(Se.G,{})]})}var Ee=a(17554),Ie=a(67507);function Te(){const[e,t]=(0,n.useState)(!1),{automation:a}=(0,p.Z)((e=>({automation:e(D.storeName).getAutomationData()})),[]),{trash:i}=(0,Z.Z)(D.storeName);return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsxs)(Ie.Z,{isOpen:e,title:(0,v.__)("Delete automation","mailpoet"),confirmButtonText:(0,v.__)("Yes, delete","mailpoet"),onConfirm:async()=>{i((()=>{t(!1)}))},onCancel:()=>t(!1),__experimentalHideHeader:!1,children:[(0,v.sprintf)((0,v.__)('You are about to delete the automation "%s".',"mailpoet"),a.name),(0,E.jsx)("br",{}),(0,v.__)(" This will stop it for all subscribers immediately.","mailpoet")]}),(0,E.jsx)(l.ZP,{variant:"secondary",isDestructive:!0,onClick:()=>t(!0),children:(0,v.__)("Move to Trash","mailpoet")})]})}var Pe=a(92295),Fe=a(38088);function Le(){const e=Fe.Hooks.applyFilters("mailpoet.automation.settings.render",{});return 0===Object.keys(e).length?null:(0,E.jsx)(Ae.Z,{title:(0,v.__)("Automation settings","mailpoet"),initialOpen:!0,children:Object.keys(e).map((t=>(0,E.jsx)(Ee.Z,{children:e[t]},t)))})}function Oe(){const{automationData:e}=(0,p.Z)((e=>({automationData:e(D.storeName).getAutomationData()})),[]),t={year:"numeric",month:"long",day:"numeric"};return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsxs)(Ae.Z,{title:(0,v.__)("Automation details","mailpoet"),initialOpen:!0,children:[(0,E.jsxs)(Ee.Z,{children:[(0,E.jsx)("strong",{children:"Date added"})," ",new Date(Date.parse(e.created_at)).toLocaleDateString(Pe.locale.toString(),t)]}),(0,E.jsxs)(Ee.Z,{children:[(0,E.jsx)("strong",{children:"Activated"})," ","active"===e.status&&new Date(Date.parse(e.updated_at)).toLocaleDateString(Pe.locale.toString(),t),"active"!==e.status&&e.activated_at&&new Date(Date.parse(e.activated_at)).toLocaleDateString(Pe.locale.toString(),t),"active"!==e.status&&!e.activated_at&&(0,E.jsx)("span",{className:"mailpoet-deactive",children:"Not activated yet."})]}),(0,E.jsxs)(Ee.Z,{children:[(0,E.jsx)("strong",{children:"Author"})," ",e.author.name]}),(0,E.jsx)(Ee.Z,{children:(0,E.jsx)(Te,{})})]}),(0,E.jsx)(Le,{})]})}const Ve=fe.Z.select({web:!0,native:!1});function Re(e){const{keyboardShortcut:t,sidebarKey:a,showIconLabels:i,automationName:o}=(0,p.Z)((e=>({keyboardShortcut:e(x.h).getShortcutRepresentation("mailpoet/automation-editor/toggle-sidebar"),sidebarKey:e(b.h).getActiveComplementaryArea(D.storeName)??D.automationSidebarKey,showIconLabels:e(D.storeName).isFeatureActive("showIconLabels"),automationName:e(D.storeName).getAutomationData().name})),[]);return(0,E.jsxs)(b.Vi,{identifier:a,header:(0,E.jsx)(ye,{sidebarKey:a}),closeLabel:(0,v.__)("Close settings","mailpoet"),headerClassName:"edit-site-sidebar-edit-mode__panel-tabs",title:(0,v.__)("Settings","mailpoet"),icon:Ne.Z,className:"edit-site-sidebar mailpoet-automation-sidebar",panelClassName:"edit-site-sidebar",smallScreenTitle:o||(0,v.__)("(no title)","mailpoet"),scope:D.storeName,toggleShortcut:t,isActiveByDefault:Ve,showIconLabels:i,...e,children:[a===D.automationSidebarKey&&(0,E.jsx)(Oe,{}),a===D.stepSidebarKey&&(0,E.jsx)(Ce,{})]})}var Ke=a(63259),Ge=a(37262),Be=a(8520),Me=a(23866),Ue=a(98323),ze=a(63181),We=a(77159),qe=a(25853),He=a(15128);function $e(e){let{onClose:t}=e;const[a,i]=(0,n.useState)(!1),{activate:o}=(0,Z.Z)(D.storeName);return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsxs)("div",{className:"mailpoet-automation-activate-panel__header",children:[(0,E.jsx)("div",{className:"mailpoet-automation-activate-panel__header-activate-button",children:(0,E.jsxs)(l.ZP,{variant:"primary",disabled:a,isBusy:a,autoFocus:!a,onClick:()=>{i(!0),o()},children:[a&&(0,v.__)("Activating…","mailpoet"),!a&&(0,v.__)("Activate","mailpoet")]})}),(0,E.jsx)("div",{className:"mailpoet-automation-activate-panel__header-cancel-button",children:(0,E.jsx)(l.ZP,{variant:"secondary",onClick:t,disabled:a,children:(0,v.__)("Cancel","mailpoet")})})]}),a&&(0,E.jsx)("div",{className:"mailpoet-automation-activate-panel__body",children:(0,E.jsx)(qe.ZP,{})}),!a&&(0,E.jsxs)("div",{className:"mailpoet-automation-activate-panel__body",children:[(0,E.jsx)("p",{children:(0,E.jsx)("strong",{children:(0,v.__)("Are you ready to activate?","mailpoet")})}),(0,E.jsx)("p",{children:(0,v.__)("Double-check your settings before activating.","mailpoet")})]})]})}function Ye(e){let{onClose:t}=e;const{automation:a}=(0,p.Z)((e=>({automation:e(D.storeName).getAutomationData()})),[]);return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)("div",{className:"mailpoet-automation-activate-panel__header",children:(0,E.jsx)(l.ZP,{icon:He.Z,onClick:t,label:(0,v.__)("Close","mailpoet")})}),(0,E.jsxs)("div",{className:"mailpoet-automation-activate-panel__body",children:[(0,E.jsx)("div",{className:"mailpoet-automation-activate-panel__section",children:(0,v.sprintf)((0,v.__)('"%s" is now live.',"mailpoet"),a.name)}),(0,E.jsx)("p",{children:(0,E.jsx)("strong",{children:(0,v.__)("What’s next?","mailpoet")})}),(0,E.jsx)("p",{children:(0,v.__)("View all your automations to track statistics and create new ones.","mailpoet")}),(0,E.jsx)(l.ZP,{variant:"secondary",onClick:()=>{window.location.href=J.x.urls.automationListing},children:(0,v.__)("View all automations","mailpoet")})]})]})}function Qe(){const{automation:e,errors:t}=(0,p.Z)((e=>({errors:e(D.storeName).getErrors(),automation:e(D.storeName).getAutomationData()})),[]),{closeActivationPanel:a}=(0,Z.Z)(D.storeName);if((0,n.useEffect)((()=>{t&&a()}),[t,a]),t)return null;const i=e.status===C.b.ACTIVE;return(0,E.jsxs)("div",{className:"mailpoet-automation-activate-panel",children:[i&&(0,E.jsx)(Ye,{onClose:a}),!i&&(0,E.jsx)($e,{onClose:a})]})}function Je(e){return(0,u.select)(D.storeName).getAutomationSaved()?"":(e.returnValue=(0,v.__)("There are unsaved changes that will be lost. Do you want to continue?","mailpoet"),e.returnValue)}function Xe(){const{isFullscreenActive:e,isInserterOpened:t,isActivationPanelOpened:a,isSidebarOpened:i,showIconLabels:s,automation:h}=(0,p.Z)((e=>({isFullscreenActive:e(D.storeName).isFeatureActive("fullscreenMode"),isInserterOpened:e(D.storeName).isInserterSidebarOpened(),isSidebarOpened:e(D.storeName).isSidebarOpened(),isActivationPanelOpened:e(D.storeName).isActivationPanelOpened(),showIconLabels:e(D.storeName).isFeatureActive("showIconLabels"),automation:e(D.storeName).getAutomationData()})),[]),[j,f]=(0,n.useState)(!0);(0,n.useEffect)((()=>(window.addEventListener("beforeunload",Je),()=>window.removeEventListener("beforeunload",Je))),[]),(0,n.useEffect)((()=>{j&&(function(){const e=(0,u.select)(D.storeName).getAutomationData();if(![C.b.ACTIVE,C.b.DEACTIVATING].includes(e.status))return;if(0===e.stats.totals.in_progress)return;const{createNotice:t}=(0,u.dispatch)(m.h);t("success",(0,v.__)("Editing an active automation is temporarily unavailable. We are working on introducing this functionality.","mailpoet"),{type:"snackbar"})}(),f(!1))}),[j]);const N=o()("interface-interface-skeleton",{"is-sidebar-opened":i,"show-icon-labels":s});return"trash"===h.status?(window.location.href=(0,g.f)(J.x.urls.automationListing,{[ze.E.automationHadBeenDeleted]:h.id}),null):(0,E.jsx)(x.vn,{children:(0,E.jsxs)(r.zt,{children:[(0,E.jsx)(b.x4,{isActive:e}),(0,E.jsx)(ce,{}),(0,E.jsx)(Re,{}),(0,E.jsx)(b.v4,{className:N,drawer:e&&(0,E.jsx)("div",{className:"edit-site-navigation-toggle",children:(0,E.jsx)(l.ZP,{className:"edit-site-navigation-toggle__button has-icon",href:"admin.php?page=mailpoet-automation",children:(0,E.jsx)(c.Z,{size:36,icon:_.Z})})}),header:(0,E.jsx)(le,{showInserterToggle:!1}),content:(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(je,{}),(0,E.jsx)(Ke.q,{context:"edit"})]}),sidebar:(0,E.jsx)(b.Vi.Slot,{scope:D.storeName}),secondarySidebar:null}),a&&(0,E.jsx)(Qe,{}),(0,E.jsx)(d.Z.Slot,{})]})})}window.addEventListener("DOMContentLoaded",(()=>{if((0,v.setLocaleData)(window.wp.i18n.getLocaleData()),void 0!==window.wp.date.getSettings){const e=window.wp;(0,h.setSettings)(e.date.getSettings())}else{const e=window.wp;(0,h.setSettings)(e.date.__experimentalGetSettings())}(0,D.createStore)();const e=document.getElementById("mailpoet_automation_editor");e&&((0,j.registerTranslations)(),We.Z.use((async(e,t)=>{try{return await t(e)}catch(e){var a;const t=e,i=null===(a=t.data)||void 0===a?void 0:a.status;if("mailpoet_automation_not_valid"===t.code)return void(0,u.dispatch)(D.storeName).setErrors({steps:t.data.errors});if(i&&i>=400&&i<500){const e=t.message;return(0,u.dispatch)(m.h).createErrorNotice(e??(0,v.__)("An unknown error occurred.","mailpoet"),{explicitDismiss:!0}),void(0,u.dispatch)(D.storeName).setErrors({steps:[]})}throw(0,u.dispatch)(m.h).createErrorNotice((0,v.__)("An unknown error occurred.","mailpoet"),{explicitDismiss:!0}),e}})),(0,Ge.q)(),(0,Be.j)(),(0,Me.j)(),(0,Ue.j)(),s.render((0,E.jsx)(Xe,{}),e))}))},65311:function(e){e.exports=jQuery}},function(e){e.O(0,[351],(function(){return 43223,e(e.s=43223)})),e.O()}]);